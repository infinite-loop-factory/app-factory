# 사용자 플로우 (User Flow)

이 문서는 Dist Interactive Metro 앱의 사용자 플로우와 화면 이동을 정의합니다.

## 📱 주요 화면 구성

### 1. 홈 화면 (Home Screen)
- 앱 시작 시 첫 화면
- **기본 구성**: 출발역(빈칸) + 도착역(빈칸). 가장 친숙하고 편리한 형태.
- **선택 영역**: 출발역(빈칸) / 도착역(빈칸) / 경유 추가(선택)
- 각 영역 탭 시 **서로 다른 인터페이스**로 이동 (출발역 전용, 도착역 전용, 경유 추가 전용)
- GPS 기반 최근 역 자동 추천은 출발역 선택 인터페이스에서 활용 (선택사항)

### 2. 출발역 선택 인터페이스
- 출발역 전용 화면/모달
- 역 검색, 노선별 역 목록
- GPS 사용 시: 현재 위치 기반 최근 역 자동 추천

### 3. 도착역 선택 인터페이스
- 도착역 전용 화면/모달
- 역 검색, 노선별 역 목록
- 출발역과 동일 역 선택 방지

### 4. 경유 추가 인터페이스
- 경유역 전용 화면/모달
- 경유역 검색·목록·순서 조정 등

### 5. 역 선택 화면 (공통 참고)
- 출발/도착/경유 각각에 맞는 검색·목록·필터 제공

### 6. 경로 결과 화면 (Route Result Screen)
- 경로 탐색 결과 표시
- 경로 요약 정보
- 경로 옵션 선택

### 7. 경로 상세 화면 (Route Detail Screen)
- 구간별 상세 정보
- 시각적 경로 표시

---

## 🔄 사용자 플로우 다이어그램

```
[앱 시작]
    ↓
[홈 화면] 출발(빈칸) / 도착(빈칸) / 경유 추가
    ├─→ [출발역 전용 인터페이스]
    ├─→ [도착역 전용 인터페이스]
    ├─→ [경유 추가 전용 인터페이스]
    │
    └─→ 출발·도착 선택 후 [경로 찾기]
                         ↓
                 [경로 탐색 중...]
                         ↓
                 [경로 결과 화면]
                         ↓
                 [경로 상세 화면]
                         ↓
                 [홈 화면]
```

---

## 📋 상세 플로우

### 시나리오 1: 기본 경로 탐색

1. **앱 시작**
   - 홈 화면 표시
   - 출발역(빈칸) + 도착역(빈칸) + 경유 추가(선택) 영역 표시
   - GPS 권한 요청 (선택사항)

2. **출발역 선택**
   - 출발역(빈칸) 영역 탭
   - **출발역 전용 인터페이스**로 이동 (출발역 선택 화면/모달)
   - **GPS 사용 시**: 현재 위치 기반 최근 역 자동 추천 표시
   - 역 검색 또는 노선별 선택
   - 역 선택 완료 → 홈 화면으로 복귀, 출발역 칸에 선택 역 표시

3. **도착역 선택**
   - 도착역(빈칸) 영역 탭
   - **도착역 전용 인터페이스**로 이동 (도착역 선택 화면/모달)
   - 역 검색 또는 노선별 선택
   - 역 선택 완료 → 홈 화면으로 복귀, 도착역 칸에 선택 역 표시

4. **경유 추가** (선택)
   - 경유 추가 영역 탭 시 **경유역 전용 인터페이스**로 이동
   - 경유역 검색·추가·순서 조정 후 홈으로 복귀

5. **경로 탐색**
   - 출발역과 도착역 모두 선택 완료
   - "경로 찾기" 버튼 활성화
   - 버튼 클릭 → 경로 탐색 시작
   - **GPS 사용 시**: 현재 위치 기반 경로 최적화
   - 로딩 인디케이터 표시

6. **경로 결과 확인**
   - 경로 탐색 완료
   - 경로 결과 화면 표시
   - **여러 경로 옵션 제공** (최단 거리, 최소 환승, 최적 경로 등)
   - 각 경로별 거리, 시간, 환승 정보 표시
   - 경로 요약 정보 확인
   - "상세 보기" 버튼으로 상세 정보 확인 가능

7. **경로 상세 확인**
   - 경로 상세 화면 표시
   - 구간별 정보 확인 (거리, 시간 포함)
   - "다시 검색" 버튼으로 홈 화면 복귀

---

### 시나리오 2: GPS 기반 자동 경로 추천

1. **앱 시작 및 위치 권한**
   - 앱 시작 시 위치 권한 요청
   - 권한 허용 시 GPS 활성화

2. **자동 역 추천**
   - 출발역(빈칸) 탭 시 **출발역 전용 인터페이스**에서 현재 위치 기반 가장 가까운 역 자동 추천
   - 홈 화면 출발역 칸에 "현재 위치 근처 역" 또는 선택 역 표시
   - 사용자가 수정 가능 (출발역 칸 다시 탭 → 출발역 전용 인터페이스)

3. **경로 탐색**
   - 출발역(자동 추천 또는 사용자 선택) + 도착역(도착역 칸 탭 → 도착역 전용 인터페이스에서 선택)
   - 경로 탐색 시 현재 위치 고려하여 최적화

4. **최적화된 경로 제안**
   - 현재 위치에서 출발역까지의 거리 포함
   - 전체 경로 거리 최소화
   - 여러 옵션 제공

---

### 시나리오 3: 역 검색

1. **역 검색 시작**
   - 역 선택 화면에서 검색 입력 필드에 입력
   - 실시간 검색 결과 표시

2. **검색 결과 확인**
   - 검색어와 일치하는 역 목록 표시
   - 역명 하이라이트 표시
   - 소속 노선 정보 표시

3. **역 선택**
   - 검색 결과에서 역 선택
   - 선택 완료 → 이전 화면으로 복귀

---

### 시나리오 4: 경로 옵션 선택

1. **경로 옵션 확인**
   - 경로 결과 화면에서 여러 경로 옵션 표시
   - 각 옵션별 거리, 환승 횟수 표시

2. **옵션 선택**
   - 원하는 경로 옵션 선택
   - 선택한 경로의 상세 정보 표시

---

## 🎨 화면별 상세 스펙

### 홈 화면
```
기본 구성 (가장 친숙하고 편리한 형태):
- 출발역 (빈칸) — 탭 시 출발역 전용 인터페이스로 이동
- 도착역 (빈칸) — 탭 시 도착역 전용 인터페이스로 이동
- 경유 추가 (선택) — 탭 시 경유역 전용 인터페이스로 이동

구성 요소:
- 앱 로고/제목
- 출발역 영역 (빈칸 또는 선택 역 표시)
  - 미선택: "출발역" 또는 "출발역 선택" 빈칸
  - 선택 후: 선택한 역명 표시, 탭 시 출발역 전용 인터페이스
  - GPS 사용 시: 출발역 전용 인터페이스에서 "현재 위치 근처 역" 추천
- 도착역 영역 (빈칸 또는 선택 역 표시)
  - 미선택: "도착역" 또는 "도착역 선택" 빈칸
  - 선택 후: 선택한 역명 표시, 탭 시 도착역 전용 인터페이스
- 경유 추가 (선택)
  - 탭 시 경유역 전용 인터페이스 (경유역 검색·추가·순서 조정)
- "경로 찾기" 버튼 (출발·도착 모두 선택 시 활성화)
- GPS 토글 버튼 (위치 기반 추천 on/off, 선택사항)
- 최근 검색한 경로 (선택사항)

인터페이스 분리:
- 출발역(빈칸) 탭 → 출발역 전용 인터페이스 (다른 UI)
- 도착역(빈칸) 탭 → 도착역 전용 인터페이스 (다른 UI)
- 경유 추가 탭 → 경유 추가 전용 인터페이스 (다른 UI)
```

### 출발역 / 도착역 / 경유 추가 선택 인터페이스
```
출발역 전용: 역 검색, 노선별 목록, GPS 사용 시 "현재 위치 근처 역" 추천
도착역 전용: 역 검색, 노선별 목록, 출발역과 동일 역 선택 방지
경유 추가 전용: 경유역 검색·목록·추가·순서 조정

공통 요소:
- 검색 입력 필드
- 노선별 탭 또는 필터
- 역 목록 (스크롤 가능)
- 최근 선택한 역 (선택사항)
- 역 목록 아이템: 역명 (한글, 영문), 소속 노선 정보, 역 번호
```

### 경로 결과 화면
```
구성 요소:
- 경로 옵션 목록 (여러 경로 제공)
  - 각 옵션별 카드
- 선택된 경로 상세 정보
  - 총 거리
  - 소요 시간
  - 환승 횟수
  - 경유 역 개수
- "상세 보기" 버튼
- "다시 검색" 버튼

경로 옵션 아이템:
- 경로 요약 (거리, 시간, 환승)
- 경로 미리보기 (간단한 노선 표시)
- GPS 사용 시: "현재 위치 기준 최적 경로" 표시
- 각 옵션별 비교 정보
```

### 경로 상세 화면
```
구성 요소:
- 경로 요약 헤더
- 구간별 상세 정보 리스트
- 시각적 경로 표시 (노선도 형태)
- "다시 검색" 버튼

구간 정보:
- 승차 역
- 승차 노선
- 하차 역
- 하차 노선
- 구간 거리
- 구간 소요 시간
- 환승 정보 (해당 시)
- GPS 사용 시: 현재 위치에서 출발역까지 거리 표시
```

---

## ⚠️ 에러 처리 플로우

### 에러 시나리오 1: 동일한 역 선택
```
사용자 액션: 출발역과 도착역을 동일하게 선택
처리:
- 경로 찾기 버튼 비활성화
- 에러 메시지 표시: "출발역과 도착역이 같습니다"
```

### 에러 시나리오 2: 경로 없음
```
상황: 출발역과 도착역이 연결되지 않은 경우
처리:
- "경로를 찾을 수 없습니다" 메시지 표시
- 가능한 경우 대안 제시 (예: 다른 역으로 환승)
```

### 에러 시나리오 3: 데이터 로딩 실패
```
상황: 지하철 노선 데이터 로딩 실패 (API 오류 등)
처리:
- 에러 메시지 표시
- 캐시된 데이터 사용 시도
- 재시도 버튼 제공
- 오프라인 모드 안내
```

### 에러 시나리오 4: GPS 권한 거부
```
상황: 사용자가 위치 권한 거부
처리:
- GPS 기능 없이 기본 경로 탐색 제공
- 권한 재요청 옵션 제공 (설정 화면)
- 수동 역 선택으로 진행 가능
```

### 에러 시나리오 5: 위치 정보 없음
```
상황: GPS는 허용했으나 위치 정보를 가져올 수 없음
처리:
- "위치를 찾을 수 없습니다" 메시지
- 수동 역 선택으로 진행 가능
- 재시도 옵션 제공
```

---

## 🔄 상태 관리

### 전역 상태
- 선택된 출발역
- 선택된 도착역
- GPS 활성화 여부
- 현재 위치 정보
- 최근 검색한 경로 목록
- 로딩 상태
- 데이터 캐시 상태

### 로컬 상태 (화면별)
- 역 선택 화면: 검색어, 필터 상태
- 경로 결과 화면: 선택한 경로 옵션
- 경로 상세 화면: (필요 시)

---

## 📝 구현 참고사항

### GPS 기능
- expo-location 패키지 사용
- 권한 요청 및 처리 로직
- 위치 기반 최적 경로 계산

### 데이터 관리
- API 우선, 캐시 폴백 전략
- 오프라인 시 캐시된 데이터 활용
- 데이터 업데이트 주기 관리
